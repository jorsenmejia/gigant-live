jQuery(document).ready(function(f){"use strict";var p={init:function(){f(".wc-appointments-appointment-form").each(function(){var t=f(this).closest("form"),d=t.find(".picker:eq(0)");t.on("addon-duration-changed",function(t,e){var a=parseInt(d.attr("data-appointment_duration"),10),i=parseInt(e,10),n=parseInt(a+i,10);d.data("combined_duration",n),d.data("addon_duration",e),p.show_available_time_slots(this)}),p.time_picker_init(t)}),f("body").on("change","#wc_appointments_field_timezone",function(){p.show_available_time_slots(this)}),f(".wc-appointments-appointment-form").parents("form").on("date-selected",function(){p.show_available_time_slots(this)})},time_picker_init:function(a){a.find(".slot-picker").on("click","a",function(t){t.preventDefault();var e=f(this).parent().data("slot");p.set_selected_time(a,e)})},set_selected_time:function(t,e){var a=t.find(".wc-appointments-appointment-form-button"),i=t.find(".slot-picker");if(a.prop("disabled",!0),undefined!==e){var n=i.find('[data-slot="'+e+'"]'),d=n.find("a").data("value");if(undefined!==n.data("slot")){var s=t.find(".slot-picker").parent("div").find("input");return s.val(d),s.attr("data-value",e),t.triggerHandler("time-selected"),i.find("li").removeClass("selected"),n.addClass("selected"),"selected"}}},show_available_time_slots:function(t){var i=f(t).closest("form"),e=i.find(".picker:eq(0)"),n=i.find(".slot-picker"),a=i.find("fieldset"),d=parseInt(a.find("input.appointment_date_year").val(),10),s=parseInt(a.find("input.appointment_date_month").val(),10),o=parseInt(a.find("input.appointment_date_day").val(),10),l=n.find(".selected").data("slot"),r=e.attr("data-is_autoselect"),c=e.data("addon_duration")?e.data("addon_duration"):0;d&&s&&o&&(n.closest("div").find("input").val("").change(),n.closest("div").block({message:null,overlayCSS:{background:"#fff",backgroundSize:"16px 16px",opacity:.6}}).show(),f.ajax({type:"POST",url:wc_appointment_form_params.ajax_url,data:{action:"wc_appointments_get_slots",form:i.serialize(),duration:c},success:function(t){n.html(t),n.closest("div").unblock();var e=p.set_selected_time(i,l);if(null!==wca_get_querystring("time")&&undefined===e){var a=n.find('li.slot[data-slot="'+wca_get_querystring("time")+'"]').not(".slot_empty");0<a.length?(i.triggerHandler("selected-time-unavailable",a),a.find("a").click()):p.autoselect_first_available_time(i)}else r&&undefined===e&&p.autoselect_first_available_time(i)},dataType:"html"}))},autoselect_first_available_time:function(t){var e=t.find(".picker:eq(0)"),a=t.find(".slot-picker"),i=e.find("td.ui-datepicker-current-day").not(".ui-state-disabled"),n=a.find('li.slot:not(".slot_empty"):first'),d=e.attr("data-is_autoselect");if(0<n.length&&n.has("a")){var s=n.data("slot");p.set_selected_time(t,s)}else d&&i.nextAll("td:not(.ui-state-disabled)").add(i.closest("tr").nextAll().find("td")).slice(0,1).click()}};p.init()});